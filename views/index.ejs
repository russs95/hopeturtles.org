<% const extraStyles = ['https://unpkg.com/leaflet@1.9.4/dist/leaflet.css']; %>
<%- include('partials/header', { pageTitle, theme, extraStyles }) %>
<%- include('partials/nav') %>
<main id="main" class="layout">
  <section class="hero">
    <div class="hero-image">
      <img src="/images/hopeturtles-floating-1000px.webp" alt="Illustration of a Hope Turtle floating in the ocean" loading="lazy" />
    </div>
    <div class="hero-metrics">
      <div class="metric-card">
        <span class="metric-value"><%= summary.missions %></span>
        <span class="metric-label"><%= t.metric_missions || 'Missions' %></span>
      </div>
      <div class="metric-card">
        <span class="metric-value"><%= summary.turtles %></span>
        <span class="metric-label"><%= t.metric_turtles || 'Hope Turtles' %></span>
      </div>
      <div class="metric-card">
        <span class="metric-value"><%= summary.successes %></span>
        <span class="metric-label"><%= t.metric_success || 'Successful Landfalls' %></span>
      </div>
    </div>
  </section>

  <section class="missions-preview">
    <header>
      <h2><%= t.preview_missions || 'Active Missions' %></h2>
      <p><%= t.preview_missions_copy || 'Mapping the journeys of each Hope Turtle as they drift toward communities in need.' %></p>
    </header>
    <div class="mission-cards">
      <% missions.forEach(function (mission) { %>
        <% const statusKey = (mission.status || 'unknown').toLowerCase(); %>
        <% const statusLabel = mission.status ? mission.status.charAt(0).toUpperCase() + mission.status.slice(1) : 'Unknown'; %>
        <% const hasTarget = mission.target_lat != null && mission.target_lng != null; %>
        <article class="card mission-card" data-status="<%= mission.status %>">
          <span class="status-pill status-<%= statusKey %>"><%= statusLabel %></span>
          <header class="card-header">
            <h3><%= mission.name %></h3>
          </header>
          <% if (hasTarget) { %>
            <div
              class="mission-card-map"
              data-map-token="<%= mapboxToken %>"
              data-lat="<%= mission.target_lat %>"
              data-lng="<%= mission.target_lng %>"
              data-zoom="7.4"
            >
              <div
                id="missionPreviewMap-<%= mission.mission_id %>"
                class="map-canvas"
                aria-label="Map preview for <%= mission.name %>"
              ></div>
            </div>
          <% } %>
          <p><%= mission.description %></p>
          <ul class="card-meta">
            <li><strong>Target:</strong> <%= hasTarget ? mission.target_lat + ', ' + mission.target_lng : 'To be announced' %></li>
          </ul>
          <a href="/missions#mission-<%= mission.mission_id %>" class="button ghost">View details</a>
        </article>
      <% }) %>
    </div>
  </section>

  <section class="success-log" id="success">
    <header>
      <h2><%= t.preview_success || 'Recent Landfalls' %></h2>
      <p><%= t.preview_success_copy || 'Moments of gratitude when Hope Turtles deliver their packages.' %></p>
    </header>
    <div class="success-grid">
      <% successEntries.forEach(function (entry) { %>
        <article class="success-card">
          <div class="success-meta">
            <span><strong>Lat:</strong> <%= entry.location_lat %></span>
            <span><strong>Lng:</strong> <%= entry.location_lng %></span>
          </div>
          <p><%= entry.thank_you_message || 'Ocean blessings received.' %></p>
        </article>
      <% }) %>
    </div>
    <div class="success-actions">
      <a class="button" href="/success"><%= t.submit_success || 'Record a Landed Turtle' %></a>
    </div>
  </section>
</main>
<% const pageScripts = [
  'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js',
  '/js/home.js'
]; %>
<%- include('partials/footer', { pageScripts }) %>
